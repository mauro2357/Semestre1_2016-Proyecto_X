package controladores;

import java.io.IOException;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import repositorios.AgregarUsuarios;


/**
 * Servlet implementation class UsuariosControlador
 */
@WebServlet("/UsuariosControlador")
public class UsuariosControlador extends HttpServlet {
	private static final long serialVersionUID = 1L;
	private RequestDispatcher rd;

	protected void processRequest(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
	        	response.setContentType("text/html;charset=UTF-8");
	        try{
	        	 int id = Integer.parseInt(request.getParameter("id"));
	             String n ="'"+ request.getParameter("nombre")+"',";
	             String fn ="'"+ request.getParameter("fechaN")+"',";
	             String dir ="'"+ request.getParameter("direccion")+"',";
	             String tel = "'"+request.getParameter("tel")+"',";
	             String email ="'"+ request.getParameter("email")+"',"; 
	             String c= "'"+ request.getParameter("password")+"',";
	             String tc = "'"+ request.getParameter("tipou")+"'";
	             String todos = id+n+fn+dir+tel+email+c+tc;
	             System.out.println(todos);
	             AgregarUsuarios datos = new AgregarUsuarios();
	             datos.crearConexion();
	             if(datos.ejecutarSQL(todos)){
	                 rd = request.getRequestDispatcher("VistaEntrenador.jsp");
	                 rd.forward(request, response);
	             } 
	             else
	             {
	                 rd = request.getRequestDispatcher("redireccion.html");
	                 rd.forward(request, response);
	             }    
	        }catch(NumberFormatException e) {
	            request.setAttribute("estado", "error");
	        }finally{
	        	
	        }
	    }
	public int cantidad(){
  	  try{
  		  
  		     		  
            String consulta= ("select count(*) as cantidad from bd_mananger_fitness.usuarios;");
            conexion.crearConexion();  
            ResultSet miconsulta = conexion.ejecutarSQLSelect(consulta);
            
            if(miconsulta.next()){
          	  int cant = miconsulta.getInt("cantidad");
          	  System.out.println(cant);
                return cant;
            }
        } 
             catch (SQLException ex){
		Logger.getLogger(inicio.class.getName()).log(Level.SEVERE, null, ex);
		return 0;
              }
		return 0;
  }



	
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public UsuariosControlador() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		response.getWriter().append("Served at: ").append(request.getContextPath());
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
